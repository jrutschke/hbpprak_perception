<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Thimblerigger - Perception Challenge: Thimblerigger Challenge of the NRP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Thimblerigger - Perception Challenge
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Thimblerigger Challenge of the NRP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository defines the challenge perception "Thimblerigger". It is part of the KIT course "Virtual Neurorobotics".</p>
<p>This repo is for the <b>challenge definition</b> only, to create a solution please fork this repository and implement your solution there.</p>
<h2>Installing</h2>
<p>Assuming that you have a local install of the <a href="https://bitbucket.org/hbpneurorobotics/neurorobotics-platform">NRP</a>, no special setup is needed. Simply fork this repo into the <b>Experiments</b> folder. When starting the NRP frontend, you should now see an experiment called <b>PerceptionChallengeKIT</b>.</p>
<h2>Running the experiment</h2>
<p>Start the experiment. You will be in a paused state with nothing in the world but an iCub Robot. Once you hit the play button, three red cylinders will spawn in front of the robot. These cylinders represent 3 mugs. One of the mugs contains a green ball. The goal of the challenge is to:</p>
<ul>
<li>Check which mug contains the ball</li>
<li>Track that mug during shuffling. Shuffling computes <em>n</em> random permutations of the mug order and moves the mugs into the corresponding positions. At most 2 mugs are displaced at one time, one to either side of the original lane.</li>
<li>Tell which mug contains the ball in any way, e.g.: Publish an index, point the robot to the correct mug, ...</li>
</ul>
<h2>Interacting with the experiment</h2>
<p>The user can manually navigate through the challenge by sending the following ROS service requests. You can do this via command line, or <code>rospy.ServiceProxy</code> objects. (The challenge does nothing if you do not send these requests, it is an "interactive" challenge):</p>
<table class="doxtable">
<tr>
<th>Service name </th><th>Service Type </th><th>Description  </th></tr>
<tr>
<td>/thimblerigger/reset</td><td>std_srvs/Trigger</td><td>Despawns the mugs, respawns them in the starting sorted order and chooses a new mug under which the ball is contained </td></tr>
<tr>
<td>/thimblerigger/show_correct_mug</td><td>std_srvs/Trigger</td><td>Lifts up the mug under which the ball is contained and shows the ball </td></tr>
<tr>
<td>/thimblerigger/hide_correct_mug</td><td>std_srvs/Trigger</td><td>Hides the ball again under the mug if it was lifted up </td></tr>
<tr>
<td>/thimblerigger/shuffle</td><td>std_srvs/Trigger</td><td>Randomly permutes the mugs n times. n is a parameter of the thimblerigger challenge. </td></tr>
</table>
<p>You can also use a stepping mechanism (implemented in the state machine):</p>
<table class="doxtable">
<tr>
<th>Service name </th><th>Service Type </th><th>Description  </th></tr>
<tr>
<td>/thimblerigger/start_challenge</td><td>std_srvs/Trigger</td><td>Once the simulation is running, starts the thimblerigger state machine </td></tr>
<tr>
<td>/thimblerigger/step_challenge</td><td>std_srvs/Trigger</td><td>Steps through the challenge in this order (one step per service call): <code>Show correct mug - Hide correct mug - Shuffle - Show correct mug - (Then the state machine exits, feel free to implement a loop/reset mechanism)</code> </td></tr>
<tr>
<td>/thimblerigger/stop_challenge</td><td>std_srvs/Trigger</td><td>Currently not used </td></tr>
</table>
<h3>Training signal</h3>
<p>There is a training signal for supervised training being published under the topic <code>/thimblerigger/training_signal</code>. It publishes the index of the correct mug, as soon as it is known (meaning before the <code>/thimblerigger/show_correct_mug</code> service is called, a *-1* is published).</p>
<p>The 3 indices <code>[0, 1, 2]</code> are arranged as follows: <code>0</code> is closest to the default robot starting position, <code>2</code> the furthest away. If you reset the challenge with the service call, the training signal will be reset, too. The index switches every time the mug has reached its goal position during shuffling, but not in between.</p>
<h3>Auto-stepper</h3>
<p>If you don't want/need to manually trigger the different stages of the challenge via the ROS service calls, there is an auto-stepper which can automatically trigger the stages of the challenge for you. It is implemented in stepper.py. To use it, simply uncomment the last two lines in the state machine.</p>
<h2>What am I allowed to modify?</h2>
<h3>What you shouldn't modify</h3>
<p>There is a configuration file <code>thimblerigger_config.py</code>, that allows to configure things like topic names. The paragraph above assumes that you have not changed those.</p>
<p>You should not fiddle with the following files (and any references to one of these files in any configuration file):</p>
<ul>
<li><code>state_machine.exd</code></li>
<li><code>stepper.py</code></li>
<li><code>thimblerigger_server.py</code></li>
<li><code>thimblerigger.py</code> (this is where most interesting stuff happens)</li>
</ul>
<p>Feel free to read through them for further information how the challenge works internally, the <code>thimblerigger*.py</code> files are well documented. You can find doxygen pages in the <code>docs</code> folder.</p>
<h3>Things that you should definitely change</h3>
<p>In <code>bibi_configuration.bibi</code>:</p>
<ul>
<li>There is a <code>file</code>-tag within <code>brainModel</code> that points to a file that load the brain of the robot. This is relative to the <em>Models</em> folder in the NRP. On a local install, it is best to create a new file within the experiment repo, and put a path relative to the <em>Models</em> directory in this tag. (This is to avoid splitting the solution into multiple repos). For example: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;<span class="keywordtype">brainModel</span>&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    &lt;<span class="keywordtype">file</span>&gt;../<span class="keyword">Experiments</span>/<span class="keyword">hbpprak_perception</span>/<span class="keyword">my_custom_brain.py</span>&lt;/<span class="keywordtype">file</span>&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;/<span class="keywordtype">brainModel</span>&gt;</div></div><!-- fragment --> will allow you to have the brain file within your solution fork of the challenge repo.</li>
<li>Add transfer functions, spike recorders, etc. in the bibi file, see <a href="https://developer.humanbrainproject.eu/docs/projects/HBP%20Neurorobotics%20Platform/1.2/nrp/tutorials/transfer_function/bibi_config.html">the documentation</a>.</li>
</ul>
<h3>Things that you might want to change</h3>
<p>In <code>thimblerigger_config.py</code>:</p><ul>
<li><em>num_mugs</em>, <em>num_shuffles</em> and <em>seed</em>. The final challenge uses 3 cups, 1 shuffle, and the seed for shuffling and choice of which mug contains the ball should be random (i.e. <code>seed = None</code>).</li>
</ul>
<p>Additionally, you might want to modify:</p>
<p>In <code>ExDPerceptionChallengeKIT.exc</code>:</p>
<ul>
<li>The timeout in seconds (for debugging). Default is 10 minutes.</li>
<li>The robot starting position (<code>robotPose</code>-tag)</li>
</ul>
<h2>Additional Information</h2>
<ul>
<li><a href="https://youtu.be/aice0elP7eI">Demo video</a></li>
<li><a href="https://bitbucket.org/hbpneurorobotics/neurorobotics-platform">NRP</a></li>
<li><a href="https://forum.humanbrainproject.eu/">NRP Forum</a></li>
<li><a href="http://wiki.ros.org/ROS/Tutorials/WritingServiceClient%28python%29#rospy_tutorials.2BAC8-Tutorials.2BAC8-WritingServiceClient.Writing_the_Client_Node">Rospy service clients</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
